# WEB网络基础知识

https://blog.csdn.net/qq_40856225/article/details/82458128

https://blog.csdn.net/m0_37631322/article/details/83817807

## 1 计算机网络七层协议

1. 应用层 ： 访问网络服务的接口 （协议有：**HTTP**，**SMTP（邮件报文传输协议）**，POP3，FTP（文件传输协议），**DNS**等）
2. 表示层 ： 定义数据格式及加密（URL加密，图片编解码）
3. 会话层 ： 定义了如何开始、控制和结束一个会话，包括对多个双向会话的控制和管理
4. 传输层 ： 应用程序端点之间传输应用层报文（协议有 TCP，UDP）
5. 网络层 ： 负责将数据报的网络层分组从一台主机移动到另一台主机（IP协议）
6. 数据链路层：定义了在单个链路上如何传输数据。
7. 物理层  ： 将报文中的一个一个比特的数据从一个节点移到下一个节点

### 应用层

#### http协议

（Hyper Text Transfer Protocol（超文本传输协议））

+ 简介：

  HTTP是基于TCP/IP通信协议来传递数据的（HTML 文件, 图片文件, 查询结果等）

  HTTP协议工作于客户端-服务端架构为上。浏览器作为HTTP客户端通过URL向HTTP服务端即WEB服务器发送所有请求。Web服务器根据接收到的请求后，向客户端发送响应信息。

+ 特点

  + 简单快速：客户向服务器请求服务时，只需传送请求方法和路径。请求方法常用的有GET、HEAD、POST。
  + 灵活：HTTP允许传输任意类型的数据对象。正在传输的类型由Content-Type加以标记。
  + 无连接：无连接的含义是限制每次连接只处理一个请求。服务器处理完客户的请求，并收到客户的应答后，即断开连接。采用这种方式可以节省传输时间。
  + 无状态：HTTP协议是无状态协议。无状态是指协议对于事务处理没有记忆能力。缺少状态意味着如果后续处理需要前面的信息，则它必须重传，另一方面，在服务器不需要先前信息时它的应答就较快。

+ 工作原理

  1. 客户端连接到Web服务器 ： 登录特定的HTTP端口
  2. 发送HTTP请求 ：通过TCP套接字，客户端向Web服务器发送一个文本的请求报文（由请求头部，请求行，空行，请求数据组成）
  3. 服务器接受请求并返回HTTP响应：Web服务器解析请求，定位请求资源。服务器将资源复本写到TCP套接字，由客户端读取。（一个响应由状态行、响应头部、空行和响应数据4部分组成）
  4. 释放连接的TCP连接 ： 若connection 模式为close，则服务器主动关闭TCP连接，客户端被动关闭连接，释放TCP连接;若connection 模式为keepalive，则该连接会保持一段时间，在该时间内可以继续接收请求;
  5. 客户端浏览器解析HTML内容 ： 客户端浏览器首先解析状态行，查看表明请求是否成功的状态代码。然后解析每一个响应头，响应头告知以下为若干字节的HTML文档和文档的字符集。客户端浏览器读取响应数据HTML，根据HTML的语法对其进行格式化，并在浏览器窗口中显示。

#### HTTP请求方式

+ **GET 请求指定的页面信息，并返回实体主体。**

+ HEAD 类似于get请求，只不过返回的响应中没有具体的内容，用于获取报头

+ **POST 向指定资源提交数据进行处理请求（例如提交表单或者上传文件）。数据被包含在请求体中。POST请求可能会导致新的资源的建立和/或已有资源的修改。**

+ **PUT 从客户端向服务器传送的数据取代指定的文档的内容。**

+ DELETE 请求服务器删除指定的页面。

+ CONNECT HTTP/1.1协议中预留给能够将连接改为管道方式的代理服务器。

+ OPTIONS 允许客户端查看服务器的性能。
+ TRACE 回显服务器收到的请求，主要用于测试或诊断。





#### HTTP状态码

+ 1xx 表示成功接收请求，要求客户端继续提交下一次请求才能完成整个处理过程，接收的请求正在处理
+ 2xx 表示成果接收到并且已经完成整个处理过程
  + 200 正常 一切ok
+ 3xx 未完成请求，重定向码，客户需要进一步细化操作
  + 302重定向
  + 303 和 307 是 HTTP1.1 新加的服务器响应文档的状态码，它们是对 HTTP1.0 中的 302 状态码的细化，主要用在对非 GET、HEAD 方法的响应上。
+ 4xx 客户端错误码，服务器无法处理请求
  + 403 服务端理解客户端请求，但是拒绝处理（常见权限问题）
  + 404 服务器上不存在客户端请求的资源
+ 5xx 服务器错误码，服务器处理请求出错
  + 500 服务器发生不可预期的错误
  + 503 服务器当前不能处理客户端的请求，一段时间后可能恢复正常

#### HTTP请求报文

+ 请求行
  + 包括三个字段（请求方法，URL字段，HTTP版本字段）
+ 请求头 
  + HOST：指出对象所在主机。
  + User-Agent：首部行用来指明用户代理，即向服务器发送求请求的浏览器类型。
+ 空行 
  + 请求头后面的空行是必须的
+ 请求数据
  + 使用get方法是实体为空，使用post方法时才是用该实体。



#### HTTP响应报文

+ 状态行
  + 由HTTP协议版本号， 状态码， 状态消息 三部分组成
+ 消息报头
  + 说明客户端要使用的一些附加信息
+ 空行
+ 响应正文
  + 空行后面的html部分为响应正文。



#### HTTP 和 HTTPS

>HTTP（全称： Hypertext transfer protocol) 是一种详细规定了浏览器和万维网服务器之间互相通信规则的协议。
>
>HTTPS（全称：Hypertext Transfer Protocol over Secure Socket Layer），简单讲是HTTP的安全版，HTTP下加入SSL层，HTTPS的安全基础是SSL。https协议需要到ca（Certification Authority-认证机构）申请证书。HTTPS协议的主要作用：一种是建立一个信息安全通道，来保证数据传输的安全；另一种就是确认网站的真实性。

区别：
>
>1. HTTP发起的请求建立到服务器指定默认端口是80，HTTPS是443
>
>2. HTTP无需证书，HTTPS需要CA机构颁发的SSL证书
>
>3. HTTP工作于应用层，HTTPS工作于传输层
>
>4. HTTP信息是明文传输，HTTPS则是具有安全性的ssl加密传输协议。
>
>5. http的连接无状态,
>

https工作流程
>
>1. 浏览器访问https的网站
>
>2. 服务器收到请求，准备证书（包含：算法、公钥、证书有效期）；
>
>3. 服务器将证书发送到客户端；
>
>4. 客户端收到证书，验证（很复杂的过程），验证成功后客户端生成一个随机数，用服务端的公钥对这个随机数加密，然后用hash算法生成签名做成证书。；
>
>5. 客户端把自己生成的证书发给服务端，因为只有服务端有私钥，所以只能服务端来解密，这样就保证了即使其他人截获也没用。
>
>6. 服务端收到证书后，用私钥验签，并解密出来随机数。这个随机数就是后续网络传输数据使用的对称加密密钥了
>
>7. 后面的通信就全部用这个随机数加密传输。
>



### 传输层

传输层（又称主机到主机传输层）为应用层提供会话和数据报通信服务。传输层承担OSI传输层的职责。传输层的核心协议是TCP和UDP。

TCP提供一对一的、面向连接的可靠通信服务。TCP建立连接，对发送的数据包进行排序和确认，并恢复在传输过程中丢失的数据包。UDP提供一对一或一对多的、无连接的不可靠通信服务。

#### 面向连接服务和无连接服务

+ 面向连接的网络服务

  面向连接的网络服务又称为虚电路（Virtual Circuit）服务，它具有网络连接建立、数据传输和网络连接释放三个阶段。是按顺序传输可靠的报文分组方式，适用于指定对象、长报文、会话型传输要求。

  面向连接服务以电话系统为模式。

+ 无连接的网络服务

  无连接网络服务的两实体之间的通信不需要事先建立好一个连接。无连接网络服务有3种类型：数据报（Datagram）、确认交付（Confirmed Delivery）与请求回答（Request reply）。

  无连接服务以邮政系统为模式。

#### 传输控制协议(TCP)

##### 1.简介

TCP全称是Transmission Control Protocol，中文名为传输控制协议，它可以提供可靠的、面向连接的网络数据传递服务。传输控制协议主要包含下列任务和功能：

+ 确保IP数据报的成功传递。
+ 对程序发送的大块数据进行分段和重组。
+ 确保正确排序及按顺序传递分段的数据。
+ 通过计算校验和，进行传输数据的完整性检查。
+ 根据数据是否接收成功发送肯定消息。通过使用选择性确认，也对没有收到的数据发送否定确认。

##### 2.工作原理

**建立连接**

TCP的连接建立过程又称为TCP三次握手。

1. 先发送方主机向接收方主机发起一个建立连接的同步（SYN）请求；

2. 收方主机在收到这个请求后向发送方主机回复一个同步/确认（SYN/ACK）应答；

3. 收到此包后再向接收方主机发送一个确认（ACK），此时TCP连接成功建立，如图所示。 

![](C:\Users\wolomo\Desktop\学习笔记\MD学习笔记\learningNotes\web网络\20180906234124204.jpg)

A：您好，我是A

B：您好A，我是B

A：您好，B

一旦初始的三次握手完成，在发送和接收主机之间将按顺序发送和确认段。关闭连接之前，TCP使用类似的握手过程验证两个主机是否都完成发送和接收全部数据。TCP工作过程比较复杂，包括的内容如下。

>TCP连接关闭：发送方主机和目的主机建立TCP连接并完成数据传输后，会发送一个将结束标记置1的数据包，以关闭这个TCP连接，并同时释放该连接占用的缓冲区空间。
>
>TCP重置：TCP允许在传输的过程中突然中断连接。
>
>TCP数据排序和确认：在传输的过程中使用序列号和确认号来跟踪数据的接收情况。
>
>TCP重传：在TCP的传输过程中，如果在重传超时时间内没有收到接收方主机对某数据包的确认回复，发送方主机就认为此数据包丢失，并再次发送这个数据包给接收方。
>
>TCP延迟确认：TCP并不总是在接收到数据后立即对其进行确认，它允许主机在接收数据的同时发送自己的确认信息给对方。
>
>TCP数据保护（校验和）：TCP是可靠传输的协议，它提供校验和计算来实现数据在传输过程中的完整性！

**连接关闭**

TCP的连接建立过程又称为TCP四次挥手。

1. 发送方主机向接收方主机发起一个关闭连接请求（FIN）；
2. 接收方主机收到这个FIN，给发送方发回一个确认请求（ACK）（此时接受方可能还有数据没有传递完）；
3. 接收方主机关闭与发送方的连接，并且向发送方发出一个关闭连接请求（FIN）
4. 发送方主机发回ACK确定



A：我不想玩了，B

B：好的，我知道了（此时B还有话没说完）

B：A啊，我也不玩了

A：好的，拜拜


##### 3. 使用场景

+ 邮件
+ 语音通话

#### 用户数据报协议(UDP)

##### 1.简介

UDP全称是User Datagram Protocol，中文名为用户数据报协议。UDP 提供无连接的网络服务，该服务对消息中传输的数据提供不可靠的、最大努力传送。这意味着它不保证数据报的到达，也不保证所传送数据包的顺序是否正确。

##### 2.特点

+ 包头简单
+ 沟通简单，不需要大量的数据结构，处理逻辑和包头字段
+ 它不会建立连接，但是会监听这个地方，谁都可以传给它数据，它也可以传给任何人数据，甚至可以同时传给多个人数据。
+ 不会根据网络的情况进行拥塞控制，无论是否丢包，它该怎么发还是怎么发

 ##### 3.使用场景

+ 直播
+ 实时游戏
+ 物联网





###网络层

#### IP协议

##### 1.简介

IP协议是将多个包交换网络连接起来，它在源地址和目的地址之间传送一种称之为数据包的东西，它还提供对数据大小的重新组装功能，以适应不同网络对包大小的要求。

IP不提供可靠的传输服务，它不提供端到端的或（路由）结点到（路由）结点的确认，对数据没有差错控制，它只使用报头的校验码，它不提供重发和流量控制。如果出错可以通过ICMP报告，ICMP在IP模块中实现。

##### 2.功能

**寻址**

IP可以根据数据包包头中包括的目的地址将数据包传送到目的地址，在此过程中IP负责选择传送的道路，这种选择道路称为路由功能。

**分段**

(a) IP数据报通过不同类型的通信网络发送，IP数据报的大小会受到这些网络所规定的最大传输单元(MTU)的限制。
(b)将IP数据报拆分成一个个能够适合下层技术传输的小数据报，被分段后的IP数据报可以独立地在网络中进行转发，在到达目的主机后被重组，恢复成原来的IP数据报。

##  2.其他

### HTTP1.0、HTTP1.1 和 HTTP2.0 的区别

####  1)HTTP1.0、HTTP1.1区别

+ **长链接**
  +  HTTP 1.0需要使用keep-alive参数来告知服务器端要建立一个长连接，而HTTP1.1默认支持长连接。
  + HTTP是基于TCP/IP协议的，创建一个TCP连接是需要经过三次握手的,有一定的开销，如果每次通讯都要重新建立连接的话，对性能有影响。因此最好能维持一个长连接，可以用个长连接来发多个请求。
+ **节约带宽**
  + HTTP 1.1支持只发送header信息(不带任何body信息)，如果服务器认为客户端有权限请求服务器，则返回100，否则返回401。客户端如果接受到100，才开始把请求body发送到服务器。这样当服务器返回401的时候，客户端就可以不用发送请求body了，节约了带宽。
+ **HOST域**
  +  现在可以web server例如tomat，设置虚拟站点是非常常见的，也即是说，web server上的多个虚拟站点可以共享同一个ip和端口。 HTTP1.0是没有host域的，HTTP1.1才支持这个参数。

#### 2)**HTTP 1.1、HTTP2.0主要区别**

+ 多路复用
  + 使用了多路复用的技术，做到同一个连接并发处理多个请求，而且并发请求的数量比HTTP1.1大了好几个数量级
+ 数据压缩
  + HTTP1.1不支持header数据的压缩，HTTP2.0使用HPACK算法对header的数据进行压缩，这样数据体积小了，在网络上传输就会更快。
+ 服务器推送
  + 当我们对支持HTTP2.0的web server请求数据的时候，服务器会顺便把一些客户端需要的资源一起推送到客户端，免得客户端再次创建连接发送请求到服务器端获取。这种方式非常合适加载静态资源。 服务器端推送的这些资源其实存在客户端的某处地方，客户端直接从本地加载这些资源就可以了，不用走网络，速度自然是快很多的。

